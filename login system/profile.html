<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>الملف الشخصي - شعبة اللغة العربية</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="dark-mode.css">
  <script src="dark-mode.js"></script>
  
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;800&display=swap');

    * {
      font-family: 'Tajawal', sans-serif;
    }

    .bg-pattern {
      background-color: #f8f9fa;
      background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23e2e8f0' fill-opacity='0.4'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
    }

    .arabic-pattern {
      background-color: rgba(255, 255, 255, 0.8);
      background-image: url("data:image/svg+xml,%3Csvg width='42' height='44' viewBox='0 0 42 44' xmlns='http://www.w3.org/2000/svg'%3E%3Cg id='Page-1' fill='none' fill-rule='evenodd'%3E%3Cg id='brick-wall' fill='%23064e3b' fill-opacity='0.1'%3E%3Cpath d='M0 0h42v44H0V0zm1 1h40v20H1V1zM0 23h20v20H0V23zm22 0h20v20H22V23z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
    }

    .input-focus:focus {
      border-color: #10b981;
      box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.2);
    }

    .tab-content {
      display: none;
    }
    
    .tab-content.active {
      display: block;
      animation: fadeIn 0.5s ease-in-out;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>

<body class="bg-pattern">
  <!-- Header -->
  <header class="sticky top-0 z-50 bg-white shadow-md">
    <div class="container mx-auto px-4 py-3 flex justify-between items-center">
      <div class="flex items-center">
        <div class="text-emerald-800 mr-2">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"></path>
          </svg>
        </div>
        <div>
          <h1 class="text-xl font-bold text-emerald-800">شعبة اللغة العربية</h1>
          <p class="text-sm text-gray-600">ثانوية الفلاح بجدة</p>
        </div>
      </div>

      <!-- Dark Mode Toggle Button -->
      <button id="theme-toggle" class="theme-toggle" title="التبديل إلى الوضع الداكن">
        <svg class="sun-icon" style="display: none;" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />
        </svg>
        <svg class="moon-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
        </svg>
      </button>

      <nav class="hidden md:block">
        <ul class="flex space-x-1 space-x-reverse">
          <li><a href="saved_resource.html" class="px-3 py-2 rounded-md text-sm font-medium text-emerald-800 hover:bg-emerald-100 transition">الرئيسية</a></li>
          <li><a href="saved_resource.html#teachers" class="px-3 py-2 rounded-md text-sm font-medium text-emerald-800 hover:bg-emerald-100 transition">المعلمون</a></li>
          <li><a href="saved_resource.html#students" class="px-3 py-2 rounded-md text-sm font-medium text-emerald-800 hover:bg-emerald-100 transition">الطلاب</a></li>
          <li><a href="saved_resource.html#department-work" class="px-3 py-2 rounded-md text-sm font-medium text-emerald-800 hover:bg-emerald-100 transition">أعمال الشعبة</a></li>
          <li><a href="saved_resource.html#work" class="px-3 py-2 rounded-md text-sm font-medium text-emerald-800 hover:bg-emerald-100 transition">أعمال الطلاب</a></li>
          <li><a href="news.html" class="px-3 py-2 rounded-md text-sm font-medium text-emerald-800 hover:bg-emerald-100 transition">الأخبار</a></li>
          <li><a href="gallery.html" class="px-3 py-2 rounded-md text-sm font-medium text-emerald-800 hover:bg-emerald-100 transition">معرض الصور</a></li>
          <li><a href="contact.html" class="px-3 py-2 rounded-md text-sm font-medium text-emerald-800 hover:bg-emerald-100 transition">التواصل</a></li>
        </ul>
      </nav>

      <!-- Login Button -->
      <div class="login-btn">
        <a href="login.html" class="px-4 py-2 bg-emerald-600 text-white rounded-md hover:bg-emerald-700 transition">
          تسجيل الدخول
        </a>
      </div>
    </div>
  </header>

  <!-- Profile Section -->
  <section class="py-16">
    <div class="container mx-auto px-4">
      <div class="text-center mb-12">
        <h2 class="text-3xl font-bold text-emerald-800 mb-4">الملف الشخصي</h2>
        <p class="text-gray-600">إدارة معلومات حسابك الشخصي</p>
      </div>
      
      <div class="max-w-4xl mx-auto">
        <!-- Profile Header -->
        <div class="bg-white p-8 rounded-lg shadow-md arabic-pattern mb-8">
          <div class="flex flex-col md:flex-row items-center">
            <div class="mb-6 md:mb-0 md:mr-8">
              <div class="w-32 h-32 bg-emerald-100 rounded-full flex items-center justify-center text-4xl font-bold text-emerald-800" id="userAvatar">
                <!-- User initials will be inserted here -->
              </div>
              <button class="mt-4 text-sm text-emerald-600 hover:text-emerald-800">تغيير الصورة</button>
            </div>
            <div class="text-center md:text-right">
              <h3 class="text-2xl font-bold text-emerald-800 mb-2" id="userName">
                <!-- User name will be inserted here -->
              </h3>
              <p class="text-gray-600 mb-2" id="userEmail">
                <!-- User email will be inserted here -->
              </p>
              <span class="inline-block bg-emerald-100 text-emerald-800 px-3 py-1 rounded-full text-sm font-medium" id="userType">
                <!-- User type will be inserted here -->
              </span>
            </div>
          </div>
        </div>

        <!-- Profile Tabs -->
        <div class="bg-white rounded-lg shadow-md arabic-pattern">
          <!-- Tab Navigation -->
          <div class="flex border-b border-gray-200">
            <button id="profile-tab" class="tab-btn flex-1 py-4 px-6 font-medium text-center border-b-2 border-emerald-600 text-emerald-600" onclick="switchProfileTab('profile')">
              المعلومات الشخصية
            </button>
            <button id="security-tab" class="tab-btn flex-1 py-4 px-6 font-medium text-center border-b-2 border-transparent text-gray-600 hover:text-emerald-600" onclick="switchProfileTab('security')">
              الأمان
            </button>
            <button id="activity-tab" class="tab-btn flex-1 py-4 px-6 font-medium text-center border-b-2 border-transparent text-gray-600 hover:text-emerald-600" onclick="switchProfileTab('activity')">
              النشاط
            </button>
          </div>

          <!-- Profile Information Tab -->
          <div id="profile-content" class="tab-content active p-8">
            <form id="profileForm" class="space-y-6">
              <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                  <label for="firstName" class="block text-sm font-medium text-gray-700 mb-2">الاسم الأول</label>
                  <input type="text" id="firstName" name="firstName" 
                         class="w-full px-4 py-3 border border-gray-300 rounded-md input-focus focus:outline-none">
                </div>
                <div>
                  <label for="lastName" class="block text-sm font-medium text-gray-700 mb-2">اسم العائلة</label>
                  <input type="text" id="lastName" name="lastName" 
                         class="w-full px-4 py-3 border border-gray-300 rounded-md input-focus focus:outline-none">
                </div>
              </div>
              
              <div>
                <label for="email" class="block text-sm font-medium text-gray-700 mb-2">البريد الإلكتروني</label>
                <input type="email" id="email" name="email" readonly
                       class="w-full px-4 py-3 border border-gray-300 rounded-md bg-gray-50">
              </div>
              
              <div>
                <label for="phone" class="block text-sm font-medium text-gray-700 mb-2">رقم الهاتف</label>
                <input type="tel" id="phone" name="phone" 
                       class="w-full px-4 py-3 border border-gray-300 rounded-md input-focus focus:outline-none">
              </div>
              
              <div>
                <label for="address" class="block text-sm font-medium text-gray-700 mb-2">العنوان</label>
                <textarea id="address" name="address" rows="3" 
                          class="w-full px-4 py-3 border border-gray-300 rounded-md input-focus focus:outline-none"></textarea>
              </div>
              
              <div>
                <label for="bio" class="block text-sm font-medium text-gray-700 mb-2">نبذة شخصية</label>
                <textarea id="bio" name="bio" rows="4" 
                          class="w-full px-4 py-3 border border-gray-300 rounded-md input-focus focus:outline-none"></textarea>
              </div>
              
              <div class="flex justify-end">
                <button type="submit" class="bg-emerald-600 text-white px-6 py-3 rounded-md hover:bg-emerald-700 transition font-medium">
                  حفظ التغييرات
                </button>
              </div>
            </form>
          </div>

          <!-- Security Tab -->
          <div id="security-content" class="tab-content p-8">
            <form id="passwordForm" class="space-y-6">
              <div>
                <label for="currentPassword" class="block text-sm font-medium text-gray-700 mb-2">كلمة المرور الحالية</label>
                <input type="password" id="currentPassword" name="currentPassword" required 
                       class="w-full px-4 py-3 border border-gray-300 rounded-md input-focus focus:outline-none">
              </div>
              
              <div>
                <label for="newPassword" class="block text-sm font-medium text-gray-700 mb-2">كلمة المرور الجديدة</label>
                <input type="password" id="newPassword" name="newPassword" required 
                       class="w-full px-4 py-3 border border-gray-300 rounded-md input-focus focus:outline-none">
              </div>
              
              <div>
                <label for="confirmNewPassword" class="block text-sm font-medium text-gray-700 mb-2">تأكيد كلمة المرور الجديدة</label>
                <input type="password" id="confirmNewPassword" name="confirmNewPassword" required 
                       class="w-full px-4 py-3 border border-gray-300 rounded-md input-focus focus:outline-none">
              </div>
              
              <div class="flex justify-end">
                <button type="submit" class="bg-emerald-600 text-white px-6 py-3 rounded-md hover:bg-emerald-700 transition font-medium">
                  تغيير كلمة المرور
                </button>
              </div>
            </form>
          </div>

          <!-- Activity Tab -->
          <div id="activity-content" class="tab-content p-8">
            <div class="space-y-6">
              <div class="bg-gray-50 p-4 rounded-lg">
                <h4 class="font-medium text-gray-800 mb-2">آخر تسجيل دخول</h4>
                <p class="text-gray-600" id="lastLogin">
                  <!-- Last login time will be inserted here -->
                </p>
              </div>
              
              <div class="bg-gray-50 p-4 rounded-lg">
                <h4 class="font-medium text-gray-800 mb-2">تاريخ إنشاء الحساب</h4>
                <p class="text-gray-600" id="accountCreated">
                  <!-- Account creation date will be inserted here -->
                </p>
              </div>
              
              <div class="bg-gray-50 p-4 rounded-lg">
                <h4 class="font-medium text-gray-800 mb-2">نوع الحساب</h4>
                <p class="text-gray-600" id="accountType">
                  <!-- Account type will be inserted here -->
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <script src="auth.js"></script>
  <script>
    // Check if user is logged in
    document.addEventListener('DOMContentLoaded', function() {
      if (!auth.isLoggedIn()) {
        window.location.href = 'login.html';
        return;
      }

      loadUserProfile();
    });

    // Load user profile data
    function loadUserProfile() {
      const user = auth.getCurrentUser();
      if (!user) return;

      // Update profile header
      document.getElementById('userAvatar').textContent = user.firstName.charAt(0) + user.lastName.charAt(0);
      document.getElementById('userName').textContent = user.firstName + ' ' + user.lastName;
      document.getElementById('userEmail').textContent = user.email;
      document.getElementById('userType').textContent = getUserTypeText(user.userType);

      // Update form fields
      document.getElementById('firstName').value = user.firstName;
      document.getElementById('lastName').value = user.lastName;
      document.getElementById('email').value = user.email;
      document.getElementById('phone').value = user.profile?.phone || '';
      document.getElementById('address').value = user.profile?.address || '';
      document.getElementById('bio').value = user.profile?.bio || '';

      // Update activity information
      const users = JSON.parse(localStorage.getItem('users')) || [];
      const userData = users.find(u => u.id === user.id);
      if (userData) {
        document.getElementById('lastLogin').textContent = userData.lastLogin ? new Date(userData.lastLogin).toLocaleString('ar-SA') : 'غير محدد';
        document.getElementById('accountCreated').textContent = userData.createdAt ? new Date(userData.createdAt).toLocaleDateString('ar-SA') : 'غير محدد';
        document.getElementById('accountType').textContent = getUserTypeText(userData.userType);
      }
    }

    // Get user type text
    function getUserTypeText(userType) {
      const types = {
        'student': 'طالب',
        'teacher': 'معلم',
        'parent': 'ولي أمر',
        'admin': 'إداري'
      };
      return types[userType] || userType;
    }

    // Tab switching functionality
    function switchProfileTab(tabName) {
      // Hide all tab contents
      document.querySelectorAll('.tab-content').forEach(content => {
        content.classList.remove('active');
      });
      
      // Remove active class from all tab buttons
      document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.classList.remove('border-emerald-600', 'text-emerald-600');
        btn.classList.add('border-transparent', 'text-gray-600');
      });
      
      // Show selected tab content
      document.getElementById(tabName + '-content').classList.add('active');
      
      // Add active class to selected tab button
      document.getElementById(tabName + '-tab').classList.add('border-emerald-600', 'text-emerald-600');
      document.getElementById(tabName + '-tab').classList.remove('border-transparent', 'text-gray-600');
    }

    // Handle profile form submission
    document.getElementById('profileForm').addEventListener('submit', function(e) {
      e.preventDefault();
      
      const formData = new FormData(e.target);
      const profileData = {
        phone: formData.get('phone'),
        address: formData.get('address'),
        bio: formData.get('bio')
      };

      if (auth.updateProfile(profileData)) {
        auth.showNotification('تم تحديث الملف الشخصي بنجاح', 'success');
      } else {
        auth.showNotification('حدث خطأ أثناء تحديث الملف الشخصي', 'error');
      }
    });

    // Handle password form submission
    document.getElementById('passwordForm').addEventListener('submit', function(e) {
      e.preventDefault();
      
      const formData = new FormData(e.target);
      const currentPassword = formData.get('currentPassword');
      const newPassword = formData.get('newPassword');
      const confirmNewPassword = formData.get('confirmNewPassword');

      if (newPassword !== confirmNewPassword) {
        auth.showNotification('كلمات المرور الجديدة غير متطابقة', 'error');
        return;
      }

      if (newPassword.length < 6) {
        auth.showNotification('كلمة المرور الجديدة يجب أن تكون 6 أحرف على الأقل', 'error');
        return;
      }

      if (auth.changePassword(currentPassword, newPassword)) {
        auth.showNotification('تم تغيير كلمة المرور بنجاح', 'success');
        e.target.reset();
      } else {
        auth.showNotification('كلمة المرور الحالية غير صحيحة', 'error');
      }
    });
  </script>
</body>
</html> 